<!DOCTYPE html>
<html>
<head>
    <script type="text/javascript" src="jsmol/JSmol.min.js"></script>
	<script type="text/javascript">
	var Info = {
	  width: 500,
	  height: 500,
	  j2sPath: "jsmol/j2s",
	}
	function loadPDB() {
            var pdbId = document.getElementById("pdbId").value;
            var pdbUrl = "https://files.rcsb.org/download/" + pdbId + ".pdb";

            // Load PDB file using JSmol
            Jmol.script(jmolApplet0, "background black; load " + pdbUrl + "; cartoon only; spin on; color structure;");
        }
	</script>

    <title>Alignment | 3er Block</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="../css/styles.css"> <!-- Reference to your external CSS file -->
    <script src="../js/utils.js"></script>
    <script src="../js/static_data.js"></script>
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    <link rel="icon" type="image/png" href="../public/lmu.png">
    <script
        src="https://code.jquery.com/jquery-3.3.1.js"
        integrity="sha256-2Kok7MbOyxpgUVvAk/HJ2jigOSYS2auK4Pfzbm7uH60="
        crossorigin="anonymous">
    </script>
    <script> 
       $(function(){
        $("#header").load("../header.html", function() {
            // This code runs after the header content has been loaded
            var url = window.location.href;
            if (url.includes("alignment.html")) {
                document.getElementById("alignmentLink").classList.add("active");
            }
        }); 
       });

       function run_alignment(event){
        event.preventDefault();
        const form_data = new FormData();
        form_data.append('pdbId', document.getElementById('pdbId').value);
        form_data.append('pdbId2', document.getElementById('pdbId2').value);
        if (document.getElementById('pdbId_f').files.length != 0){
            form_data.append('pdbId_f', document.getElementById('pdbId_f').files[0]);
        }
        if (document.getElementById('pdbId2_f').files.length != 0){
            form_data.append('pdbId2_f', document.getElementById('pdbId2_f').files[0]);
        }
        
        
        form_data.append('go', document.getElementById('go').value);
        form_data.append('ge', document.getElementById('ge').value);
        form_data.append('global', document.getElementById('global').checked);
        form_data.append('local', document.getElementById('local').checked);
        form_data.append('freeshift', document.getElementById('freeshift').checked);
        form_data.append('nw', document.getElementById('nw').checked);
        form_data.append('gt', document.getElementById('gt').checked);
        form_data.append('mat_f', document.getElementById('mat_f').files[0]);

        fetch('http://bioclient1.bio.ifi.lmu.de/~hummelj/cgi-bin/api/alignment.py', {
        method: 'POST',
        body: form_data
        })
        .then(response => response.json())
        .then(data => {
            //console.log(data);
            const output = data['data']['output']
            show_alignment(output);
        })
        .catch(error => {
            console.error("Error:", error);
        });

        function show_alignment(data){

            const dataList = data.split('>')[1].split('\n');



            var output = document.getElementById('alignmentOutput');
            output.classList.add('w-full', 'flex', 'flex-col', 'items-center', 'justify-start', 'gap-4', 'rounded-lg', 'box', 'p-4', 'mt-4');
            var outputContainer = document.createElement('div');
            outputContainer.classList.add('w-full', 'flex', 'flex-col', 'items-start', 'justify-start', 'gap-4', 'rounded-lg');
            const outputHeader = document.createElement('h1');
            outputHeader.classList.add('text-xs', 'font-semibold', 'txt-lgt', 'italic');
            outputHeader.innerHTML = 'Output:';
            outputContainer.appendChild(outputHeader);
            const outputSequenceContainer = document.createElement('div');
            outputSequenceContainer.classList.add('w-full', 'flex', 'flex-col', 'items-start', 'justify-start', 'px-4', 'py-0.5', 'rounded-lg', 'border', 'border-gray-300');
            const codeFontStyle = "font-family: 'Courier New', Courier, monospace;";
            const outputSequenceHeader = document.createElement('h1');
            outputSequenceHeader.classList.add('text-xs', 'font-semibold', 'txt-lgt', 'italic');
            outputSequenceHeader.style = codeFontStyle;
            outputSequenceHeader.innerHTML = 'Alignment: ' + dataList[0]
            outputSequenceContainer.appendChild(outputSequenceHeader);
            for (let i = 1; i < dataList.length; i++) {
                const outputSequence = document.createElement('p');
                outputSequence.classList.add('text-xs', 'font-normal', 'txt-lgt');
                outputSequence.style = codeFontStyle;
                outputSequence.innerHTML = dataList[i];
                outputSequenceContainer.appendChild(outputSequence);
            }


            outputContainer.appendChild(outputSequenceContainer);
            output.appendChild(outputContainer);
        }
        
       }

    </script>
   
</head>
<body class='bg-gray-50'>

    <div id="header"></div>

    <div class="flex flex-col justify-start items-start w-full gap-2 rounded-lg box p-4 mt-4">
        <div class="w-full flex flex-row items-center justify-between gap-4 rounded-lg">
            
            <div class="w-6/12 rounded-lg bg-transparent px-4 py-2 flex flex-col gap-2">
                <div class="flex flex-row">
                    <p class="text-xs font-semibold txt-lgt italic ">Sequences:</p>
                </div>
                <div class="flex flex-row items-cente justify-start gap-2 rounded-lg px-4 py-2 ">
                    <input type="text" id="pdbId" placeholder="<head1>:<seq>,<head2>:<seq>,db_<head3>,..." class="bg-gray-50 border border-gray-300 rounded-lg p-0.5 text-xs text-center w-1/2">
                    <input type="file" id="pdbId_f" class="bg-transparent rounded-lg px-4 py-2 w-1/2">
                </div>
            </div>
            <div class="w-6/12 rounded-lg bg-transparent px-4 py-2 flex flex-col gap-2">
                <div class="flex flex-row">
                    <p class="text-xs font-semibold txt-lgt italic ">Pair(s):</p>
                </div>
                <div class="flex flex-row items-cente justify-start gap-2 rounded-lg px-4 py-2 ">
                    <input type="text" id="pdbId2" placeholder="<head1>:<head2>,<head3>:<head1>" class="bg-gray-50 border border-gray-300 rounded-lg p-0.5 text-xs text-center w-1/2">
                    <input type="file" id="pdbId2_f" class="bg-transparent rounded-lg px-4 py-2 w-1/2">
                </div>
            </div>            
        </div>

        <div class="w-full flex flex-row items-center justify-start gap-4 rounded-lg px-4 py-2">
            <div class="flex flex-col items-start">
                <div class="flex flex-row items-center">
                    <p class="text-xs font-semibold txt-lgt italic ">Penalties (optional):</p>
                </div>
                <div class="flex flex-row items-cente justify-start gap-2 rounded-lg px-4 py-0.5 mt-2 h-8">
                    <div class="flex flex-row items-center gap-1">
                        <label class="text-xs font-normal text-gray-600" for="nw">Gap open penalty</label>
                        <input class="w-8 h-5 bg-gray-50 border border-gray-300 rounded-lg p-0.5 text-xs text-center" type="text" id="go" name="go">
                    </div>
                    
                    <div class="flex flex-row items-center gap-1">
                        <label class="text-xs font-normal text-gray-600" for="nw">Gap extend penalty</label>
                        <input class="w-8 h-5 bg-gray-50 border border-gray-300 rounded-lg p-0.5 text-xs text-center" type="text" id="ge" name="ge">
                    </div>
                </div>
            </div>
            
            <div class="flex flex-col items-start">
                <div class="flex flex-row items-center">
                    <p class="text-xs font-semibold txt-lgt italic ">Type:</p>
                </div>
                <div class="flex flex-row items-cente justify-start gap-2 rounded-lg px-4 py-0.5 mt-2 h-8">
                    <div class="flex flex-row items-center gap-1">
                        <label class="text-xs font-normal text-gray-600" for="global">Global</label>
                        <input class="w-3 h-3" type="checkbox" id="global" name="checkboxGroup">
                    </div>
                    
                    <div class="flex flex-row items-center gap-1">
                        <label class="text-xs font-normal text-gray-600" for="local">Local</label>
                        <input class="w-3 h-3" type="checkbox" id="local" name="checkboxGroup">  
                    </div>
                    
                    <div class="flex flex-row items-center gap-1">
                        <label class="text-xs font-normal text-gray-600" for="freeshift">Freeshift</label>
                        <input class="w-3 h-3" type="checkbox" id="freeshift" name="checkboxGroup">
                    </div>
                </div>
            </div>

            <div class="flex flex-col items-start">
                <div class="flex flex-row items-center">
                    <p class="text-xs font-semibold txt-lgt italic ">Algorithm:</p>
                </div>
                <div class="flex flex-row items-cente justify-start gap-2 rounded-lg px-4 py-0.5 mt-2 h-8">
                    <div class="flex flex-row items-center gap-1">
                        <label class="text-xs font-normal text-gray-600" for="nw">Needleman-Wunsch</label>
                        <input class="w-3 h-3" type="checkbox" id="nw" name="checkboxGroup">
                    </div>
                    
                    <div class="flex flex-row items-center gap-1">
                        <label class="text-xs font-normal text-gray-600" for="gt">Gotoh</label>
                        <input class="w-3 h-3" type="checkbox" id="gt" name="checkboxGroup">  
                    </div>
                </div>
            </div>

            <div class="flex flex-col items-start">
                <div class="flex flex-row items-center">
                    <p class="text-xs font-semibold txt-lgt italic ">Scoring System:</p>
                </div>
                <div class="flex flex-row items-center justify-start gap-2 rounded-lg px-4 py-0.5 mt-2 h-8">
                    <p id="upl" class="text-xs font-normal text-gray-600">Upload Matrix</button>
                    <input type="file" id="mat_f">
                </div>
            </div>


        </div>
       

        <div class="w-full flex flex-row items-center justify-end gap-4 rounded-lg px-4 py-2">
            <button id="undo_button" onclick=""><p class="lnk text-lg font-semibold">Undo</p></button>
            <button id="run_button" onclick="run_alignment(event)"><p class="lnk text-lg font-semibold">Run</p></button>
        </div>

        <div class="w-full h-0.5 bg-txt-lgt-mx rounded-full"></div>
           
        <div class="w-full flex flex-row items-center justify-start gap-4 rounded-lg">
            <p class="text-xs font-normal txt-lgt">Mit dem Alignment Tool werden Gemeinsamkeiten zwischen biologischen Sequenzen gesucht. Dabei werden Nukleotid- oder Proteinsequenzen mit Sequenzdatenbanken verglichen.</p>
        </div> 
    </div>
    <div id="alignmentOutput"></div>
    <div id="validationPlots" class="flex flex-col justify-start items-start w-full gap-2 rounded-lg box p-4 mt-4">
        <div>
            <h2 class="text-lg font-semibold txt-lgt">Validation Plots</h2>
            <p class="text-xs font-normal txt-lgt"> Two files vali.pairs and vali.seqlib are created with a python script from HOMSTRAD folder containing all superfamilies with corresponding alignments. vali.seqlib contains all sequences found in the HOMSTRAD folder identified via a unique header. vali.pairs contains pairs of sequences (identified via unique header) of a shared superfamily to be aligned (all permutations of sequence pair if superfamily consists of >2 sequences).
                vali.seqlib contains 3459 sequences from all HOMSTRAD superfamilies.
                vali.pairs contains 9541 pairs of sequences to be aligned.

                alignment.jar creates a file from vali.pairs and vali.seclib. This file contains entries with a header starting with ">" and followed by 4 lines. Line 1 and 2 correspond to the predicted alignment, line 3 and 4 correspond to the reference alignment, i.e. the HOMSTRAD alignment.

                validateAli.jar takes the output of alignment.jar as input and calculates sensitivity, specificity, mean shift error, inversed mean shift error and coverage (and also identity) comparing the predicted alignment with the reference alignment. statistics are added to the header line, separated by whitespace. </p>
        </div>
        <div id="validationPlots" class="flex flex-row justify-start items-start w-full gap-2 rounded-lg box p-4 mt-4">
            <div>
                <img src="http://bioclient1.bio.ifi.lmu.de/~hummelj/public/sensitivity_box_plot.png" alt="Sensitivity Box Plot">
                <p class="text-xs font-semibold txt-lgt italic">Sensitivity Box Plot:</p>
                <p class="text-xs font-normal txt-lgt">Sensitivity values for different parameter combinations tested on HOMSTRAD derived testset.</p>
            </div>
            <div>
                <img src="http://bioclient1.bio.ifi.lmu.de/~hummelj/public/specificity_box_plot.png" alt="Specificity Box Plot">
                <p class="text-xs font-semibold txt-lgt italic">Specificity Box Plot:</p>
                <p class="text-xs font-normal txt-lgt">Specificity values for different parameter combinations tested on HOMSTRAD derived testset.</p>
            </div>
        </div>
        <div id="validationPlots" class="flex flex-row justify-start items-start w-full gap-2 rounded-lg box p-4 mt-4">
            <div>
                <img src="http://bioclient1.bio.ifi.lmu.de/~hummelj/public/mse_box_plot.png" alt="MSE Box Plot">
                <p class="text-xs font-semibold txt-lgt italic">MSE Box Plot (yaxis log10 scaled):</p>
                <p class="text-xs font-normal txt-lgt">MSE values for different parameter combinations tested on HOMSTRAD derived testset.</p>
            </div>
            <div>
                <img src="http://bioclient1.bio.ifi.lmu.de/~hummelj/public/imse_box_plot.png" alt="IMSE Box Plot">
                <p class="text-xs font-semibold txt-lgt italic">IMSE Box Plot (yaxis log10 scaled):</p>
                <p class="text-xs font-normal txt-lgt">IMSE values for different parameter combinations tested on HOMSTRAD derived testset.</p>
            </div>
        </div>
        <div id="validationPlots" class="flex flex-row justify-start items-start w-full gap-2 rounded-lg box p-4 mt-4">
            <div>
                <img src="http://bioclient1.bio.ifi.lmu.de/~hummelj/public/coverage_box_plot.png" alt="Coverage Box Plot">
                <p class="text-xs font-semibold txt-lgt italic">Coverage Box Plot:</p>
                <p class="text-xs font-normal txt-lgt">Coverage values for different parameter combinations tested on HOMSTRAD derived testset.</p>
            </div>
        </div>
        <div id="validationPlots" class="flex flex-row justify-start items-start w-full gap-2 rounded-lg box p-4 mt-4">
            <div>
                <img src="http://bioclient1.bio.ifi.lmu.de/~hummelj/public/sensitivity_violin_plot.png" alt="Sensitivity Violin Plot">
                <p class="text-xs font-semibold txt-lgt italic">Sensitivity Violin Plot:</p>
                <p class="text-xs font-normal txt-lgt">Sensitivity values for different parameter combinations tested on HOMSTRAD derived testset.</p>
            </div>
            <div>
                <img src="http://bioclient1.bio.ifi.lmu.de/~hummelj/public/specificity_violin_plot.png" alt="Specificity Violin Plot">
                <p class="text-xs font-semibold txt-lgt italic">Specificity Violin Plot:</p>
                <p class="text-xs font-normal txt-lgt">Specificity values for different parameter combinations tested on HOMSTRAD derived testset.</p>
            </div>
        </div>
        <div id="validationPlots" class="flex flex-row justify-start items-start w-full gap-2 rounded-lg box p-4 mt-4">
            <div>
                <img src="http://bioclient1.bio.ifi.lmu.de/~hummelj/public/mse_violin_plot.png" alt="MSE Violin Plot">
                <p class="text-xs font-semibold txt-lgt italic">MSE Violin Plot (limited yaxis(-5,10)):</p>
                <p class="text-xs font-normal txt-lgt">MSE values for different parameter combinations tested on HOMSTRAD derived testset.</p>
            </div>
            <div>
                <img src="http://bioclient1.bio.ifi.lmu.de/~hummelj/public/imse_violin_plot.png" alt="IMSE Violin Plot">
                <p class="text-xs font-semibold txt-lgt italic">IMSE Violin Plot (limited yaxis(-5,10)):</p>
                <p class="text-xs font-normal txt-lgt">IMSE values for different parameter combinations tested on HOMSTRAD derived testset.</p>
            </div>
        </div>
        <div id="validationPlots" class="flex flex-row justify-start items-start w-full gap-2 rounded-lg box p-4 mt-4">
            <div>
                <img src="http://bioclient1.bio.ifi.lmu.de/~hummelj/public/coverage_violin_plot.png" alt="Coverage Violin Plot">
                <p class="text-xs font-semibold txt-lgt italic">Coverage Violin Plot:</p>
                <p class="text-xs font-normal txt-lgt">Coverage values for different parameter combinations tested on HOMSTRAD derived testset.</p>
            </div>
        </div>
        
    </div>
    


</body>
</html>